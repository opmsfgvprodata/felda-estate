@model MVC_SYSTEM.Models.tbl_Pkjmast
@using MVC_SYSTEM.Class
@{
    ViewBag.Title = "WorkerUpdate";
    //Layout = "~/Views/Shared/_LayoutMain.cshtml";
    GetConfig getconfig = new GetConfig();
    GetTriager GetTriager = new GetTriager();
    string dateformat = getconfig.GetData("dateformat3");
    //HtmlHelper.UnobtrusiveJavaScriptEnabled = false;
}

<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" id="btnBack">×</button>
    <h3 class="modal-title">@GlobalResEstate.titleUpdate</h3>
</div>
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    <div class="modal-body">
        <div class="form-horizontal">
            <div class="panel panel-primary">
                <div class="panel-heading">@GlobalResEstate.lblhdrPersonalInfo.ToUpper()</div> @*modified by faeza on 08.11.2021*@
                <div class="panel-body">
                    <div class="row">
                        <div class="panel-body col-sm-9">
                            @*added by faeza on 08.11.2021*@
                            <div class="form-group">
                                <div class="col-sm-2">
                                    <label><font style="color:red">*</font> - Ruangan ini wajib diisi</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-3">
                                    <label>@GlobalResEstate.hdrNoPkj<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                                    @Html.EditorFor(model => model.fld_Nopkj, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                                    @Html.ValidationMessageFor(model => model.fld_Nopkj, "", new { @class = "text-danger" })
                                </div>
                                @*added by kamalia 2/11/2021*@
                                <div class="col-sm-3">
                                    <label>ID Pekerja Lama</label>
                                    @Html.EditorFor(model => model.fld_NoPkjLama, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                                    @Html.ValidationMessageFor(model => model.fld_NoPkjLama, "", new { @class = "text-danger" })
                                </div>
                                @*end added by kamalia 2/11/2021*@
                                <div class="col-sm-6">
                                    <label>@GlobalResEstate.hdrName<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                                    @Html.EditorFor(model => model.fld_Nama, new { htmlAttributes = new { @class = "form-control", @onkeyup = "InputToUpper(this);" } }) @*sepul tambah uppercase 21/09/2021*@
                                    @Html.ValidationMessageFor(model => model.fld_Nama, "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-3">
                                    <label>@GlobalResEstate.hdrNoKp<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                                    @*@Html.EditorFor(model => model.fld_Nokp, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })*@ @*commented by faeza 29.11.2021 - original code*@
                                    @Html.EditorFor(model => model.fld_Nokp, new { htmlAttributes = new { @class = "form-control", @onkeyup = "InputToUpper(this);" } }) @*added by faeza 29.11.2021*@
                                    @Html.ValidationMessageFor(model => model.fld_Nokp, "", new { @class = "text-danger" })
                                </div>
                                <div class="col-sm-3">
                                    <label>@GlobalResEstate.lblDOB<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                                    <div class='input-group date' id='datetimepicker1'>
                                        @Html.EditorFor(Model => Model.fld_Trlhr, new { htmlAttributes = new { @class = "form-control", @type = "text", @data_val = "false" } })

                                        @*@Html.ValidationMessageFor(model => model.fld_Trlhr, "", new { @class = "text-danger" })*@
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <label>Umur</label>
                                    @Html.TextBox("UmurPkj", "", new { @class = "form-control", @readonly = "readonly" })
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-3">
                                    <label>@GlobalResEstate.lblGender<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                                    @Html.DropDownList("fld_Kdjnt", null, htmlAttributes: new { @class = "form-control" })
                                    @Html.ValidationMessageFor(model => model.fld_Kdjnt, "", new { @class = "text-danger" })
                                </div>
                                <div class="col-sm-3">
                                    <label>@GlobalResEstate.lblMarriageStatus<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                                    @Html.DropDownList("fld_Kdkwn", null, htmlAttributes: new { @class = "form-control" })
                                    @Html.ValidationMessageFor(model => model.fld_Kdkwn, "", new { @class = "text-danger" })
                                </div>
                                <div class="col-sm-3">
                                    <label>@GlobalResEstate.lblPeneroka<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                                    @Html.DropDownList("fld_Kpenrka", null, htmlAttributes: new { @class = "form-control" })
                                    @Html.ValidationMessageFor(model => model.fld_Kpenrka, "", new { @class = "text-danger" })
                                </div>
                            </div>
                        </div>
                        @*<div class="form-group col-sm-3" style="text-align:center">
                            <img src=@ViewBag.ImageSource id="image" style="width:200px;height:200px;border:1px solid;cursor:pointer;" />
                            <input class="form-control btn btn-default btn-file" style="display:none" type="file" name="file" id="file" onchange="changemediacover()" />
                        </div>*@
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2">
                            <label>@GlobalResEstate.lblRace<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.DropDownList("fld_Kdbgsa", null, htmlAttributes: new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.fld_Kdbgsa, "", new { @class = "text-danger" })
                        </div>
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblReligion<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.DropDownList("fld_Kdagma", null, htmlAttributes: new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.fld_Kdagma, "", new { @class = "text-danger" })
                        </div>
                        <div class="col-sm-2">
                            <label>@GlobalResEstate.lblCitizen<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.DropDownList("fld_Kdrkyt", null, htmlAttributes: new { @class = "form-control", @readonly = "readonly" })
                            @Html.ValidationMessageFor(model => model.fld_Kdrkyt, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-5">
                            <label>@GlobalResEstate.lblAddress<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.EditorFor(model => model.fld_Almt1, new { htmlAttributes = new { @class = "form-control", @onkeyup = "InputToUpper(this);" } }) @*sepul tambah uppercase 21/09/2021*@
                            @Html.ValidationMessageFor(model => model.fld_Almt1, "", new { @class = "text-danger" })
                        </div>
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblPostcode<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.EditorFor(model => model.fld_Poskod, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.fld_Poskod, "", new { @class = "text-danger" })
                        </div>
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblDistrict<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.EditorFor(model => model.fld_Daerah, new { htmlAttributes = new { @class = "form-control", @onkeyup = "InputToUpper(this);" } }) @*sepul tambah uppercase 21/09/2021*@
                            @Html.ValidationMessageFor(model => model.fld_Daerah, "", new { @class = "text-danger" })
                        </div>
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblState<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.DropDownList("fld_Neg", null, htmlAttributes: new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.fld_Neg, "", new { @class = "text-danger" })
                        </div>
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblCountry<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.DropDownList("fld_Negara", null, htmlAttributes: new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.fld_Negara, "", new { @class = "text-danger" })
                        </div>
                        @*Added by faeza on 08.11.2021*@
                        <div class="col-sm-3">
                            <label>No. Telefon [cth: 60121234567]<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.EditorFor(model => model.fld_Notel, new { htmlAttributes = new { @class = "form-control digit" } })
                            @Html.ValidationMessageFor(model => model.fld_Notel, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>
                <div class="panel-heading">@GlobalResEstate.lblTotalRecord.ToUpper()</div>
                <div class="panel-body">
                    <div class="form-group">
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblWorkerType<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.DropDownList("fld_Jenispekerja", null, htmlAttributes: new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.fld_Jenispekerja, "", new { @class = "text-danger" })
                        </div>
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblWorkerKtgri<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.DropDownList("fld_Ktgpkj", null, htmlAttributes: new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.fld_Ktgpkj, "", new { @class = "text-danger" })
                        </div>
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblPermitNo</label>
                            @Html.EditorFor(model => model.fld_Prmtno, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.fld_Prmtno, "", new { @class = "text-danger" })
                        </div>
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblPermitEnd</label>
                            <div class='input-group date' id='datetimepicker1'>
                                @Html.EditorFor(Model => Model.fld_T2prmt, new { htmlAttributes = new { @class = "form-control", @type = "text", @data_val = "false" } })
                                @Html.ValidationMessageFor(model => model.fld_T2prmt, "", new { @class = "text-danger" })
                                <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblPassportEnd<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            <div class='input-group date' id='datetimepicker1'>
                                @Html.EditorFor(Model => Model.fld_T2pspt, new { htmlAttributes = new { @class = "form-control", @type = "text", @data_val = "false" } })
                                @Html.ValidationMessageFor(model => model.fld_T2pspt, "", new { @class = "text-danger" })
                                <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblDateKLIA<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            <div class='input-group date' id='datetimepicker1'>
                                @Html.EditorFor(Model => Model.fld_Trmlkj, new { htmlAttributes = new { @class = "form-control", @type = "text", @readonly = "readonly", @data_val = "false" } })
                                @Html.ValidationMessageFor(model => model.fld_Trmlkj, "", new { @class = "text-danger" })
                                <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblStartWork<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            <div class='input-group date' id='datetimepicker1'>
                                @Html.EditorFor(Model => Model.fld_Trshjw, new { htmlAttributes = new { @class = "form-control", @type = "text", @data_val = "false" } })
                                @Html.ValidationMessageFor(model => model.fld_Trshjw, "", new { @class = "text-danger" })
                                <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <label>@GlobalResEstate.lblSupplier<font style="color:red">*</font></label> @*modified by faeza on 08.11.2021*@
                            @Html.DropDownList("fld_Kodbkl", null, htmlAttributes: new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.fld_Kodbkl, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    @*Added by faeza on 08.11.2021*@
                    <div class="form-group">
                        <div class="col-sm-3">
                            <label>Mode Bayaran<font style="color:red">*</font></label>
                            @Html.DropDownList("fld_PaymentMode", null, htmlAttributes: new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.fld_PaymentMode, "", new { @class = "text-danger" })
                        </div>
                        <div class="col-sm-3">
                            <label>4 PAN Terakhir [cth: 1111]<font style="color:red">*</font></label>
                            @Html.EditorFor(model => model.fld_Last4Pan, new { htmlAttributes = new { @class = "form-control digit", @maxlength = "4", @minlength = "4" } })
                            @Html.ValidationMessageFor(model => model.fld_Last4Pan, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    @*end added faeza*@
                </div>
                @*sepul comment 21/09/2021*@
                @*<div class="panel-heading">Dokumen Sokongan</div>
        <div class="panel-body">
            <div id="pdfdoc">

            </div>

            <input class="form-control btn btn-default btn-file" type="file" name="file1" id="file1" style="display:none" />
            <button class="btn btn-primary" id="btnUploadFile" name="btnUploadFile">Upload Dokumen</button>
        </div>*@

            </div>
        </div>
    </div>
            <div class="modal-footer">
                @*@if (Model.fld_StatusApproved == 3)
                {
                    <button class="btn btn-primary" id="btnRequest" name="btnRequest">
                        Mohon Semula
                    </button>
                }*@

                @*Modified by Shazana 29/8/2023*@
                @*<button class="btn btn-primary" id="btnUpload" name="btnUpload" onclick="return DisplayProgressMessage(this);">
                    @GlobalResEstate.btnSave
                </button>*@
                @*<input id="btnUpload" class="btn btn-primary" value=@GlobalResEstate.btnSave />*@
                <input id="btnSubmit" class="btn btn-primary" type="submit" value=@GlobalResEstate.btnSave />

                <button class="btn btn-warning" data-dismiss="modal">@GlobalResEstate.btnBack</button>
            </div>
}
<script>

    $(function () {
        $('#fld_Trlhr').datetimepicker({
            timepicker: false,
            format: '@dateformat'
        });
        $('#fld_T1prmt').datetimepicker({
            timepicker: false,
            format: '@dateformat',
        });
        $('#fld_T2prmt').datetimepicker({
            timepicker: false,
            format: '@dateformat'
        });
        $('#fld_T1pspt').datetimepicker({
            timepicker: false,
            format: '@dateformat'
        });
        $('#fld_T2pspt').datetimepicker({
            timepicker: false,
            format: '@dateformat'
        });
        $('#fld_Trmlkj').datetimepicker({
            timepicker: false,
            format: '@dateformat'
        });
        $('#fld_Trshjw').datetimepicker({
            timepicker: false,
            format: '@dateformat'
        });
    });

    function defaultDate(data) {
        if (data == null || data == "") {
            var newdata = "";
            return newdata;
        }
        else{
            return data;
        }
    };

    function changemediacover() {
        var selectedImg = $('#file')[0].files[0];
        var selectedImgsize = ($("#file")[0].files[0].size / 1024);
        var selectedImgtype = $("#file")[0].files[0];
        selectedImgtype = selectedImgtype.name.substr((selectedImgtype.name.lastIndexOf('.') + 1));
        //alert(selectedImgtype);
        if (selectedImg) {
            var previewId = document.getElementById('image');
            previewId.src = '';

            var oReader = new FileReader();
            oReader.onload = function (e) {
                previewId.src = e.target.result;
            }
            oReader.readAsDataURL(selectedImg);
        }
    }

    function uploadImage() {
         if (window.FormData !== undefined) {
            var fileupload = $('#file').get(0);
            var files = fileupload.files;
            var nopkj = $("#fld_Nopkj").val();
            var ext = "";
            var filenewname = "";
            var fileData = new FormData();
            for (var i = 0; i < files.length; i++) {
                ext = files[i].name.split(".").pop();
                filenewname = nopkj.trim() + "." + ext;
                fileData.append(files[i].name, files[i], filenewname);
                console.log(ext);
                console.log(filenewname);
            }
            $.ajax({
                url: '@Url.Action("UploadFiles", "BasicInfo")',
                type: "POST",
                contentType: false,
                processData: false,
                data: fileData,
                success: function (result) {
                    //alert(result);
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }
        else {
            alert("Formdata is not supported.")
        }
    }

     function uploadSupportedFile() {
         if (window.FormData !== undefined) {
            var fileupload = $('#file1').get(0);
            var files = fileupload.files;
            var nopkj = $("#fld_Nopkj").val();
            var ext = "";
            var filenewname = "";
            var fileData = new FormData();
            for (var i = 0; i < files.length; i++) {
                ext = files[i].name.split(".").pop();
                filenewname = nopkj.trim() + "_" + files[i].name;
                fileData.append(files[i].name, files[i], filenewname);
                console.log(ext);
                console.log(filenewname);
            }
            $.ajax({
                url: '@Url.Action("UploadSupportedFiles", "BasicInfo")',
                type: "POST",
                contentType: false,
                processData: false,
                data: fileData,
                success: function (result) {
                    //alert(result);
                    //viewDoc();
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }
        else {
            alert("Formdata is not supported.")
        }
    }



                $("form").removeData("validator");
                $("form").removeData("unobtrusiveValidation");
                $.validator.unobtrusive.parse("form");
</script>
<script>
    $(document).ready(function () {
        if ($("#fld_Trlhr").val() != "") {
            var Getumur = {};
            var disableoption = "";
            Getumur.url = "@Url.Action("GetUmurPkj", "BasicInfo")";
            Getumur.type = "POST";
            Getumur.data = JSON.stringify({ sdate: $("#fld_Trlhr").val()  });
            Getumur.datatype = "json";
            Getumur.contentType = "application/json";
            Getumur.success = function (result) {
                $("#UmurPkj").val(result);
            };
            Getumur.error = function () { $.simplyToast('@GlobalResEstate.msgError', 'danger'); };
            $.ajax(Getumur);
        }

         $("#fld_Trlhr").change(function () {
            var Getumur = {};
            var disableoption = "";
            Getumur.url = "@Url.Action("GetUmurPkj", "BasicInfo")";
            Getumur.type = "POST";
            Getumur.data = JSON.stringify({ sdate: $("#fld_Trlhr").val()  });
            Getumur.datatype = "json";
            Getumur.contentType = "application/json";
            Getumur.success = function (result) {
                $("#UmurPkj").val(result);
            };
            Getumur.error = function () { $.simplyToast('@GlobalResEstate.msgError', 'danger'); };
            $.ajax(Getumur);
        });

        if ($("#fld_Kdrkyt").val() == 0) {
            var Kdrkyt = {};
            var disableoption = "";
            Kdrkyt.url = "@Url.Action("GetNopkj", "BasicInfo")";
            Kdrkyt.type = "POST";
            Kdrkyt.data = JSON.stringify({ krkytn: $("#fld_Kdrkyt").val() });
            Kdrkyt.datatype = "json";
            Kdrkyt.contentType = "application/json";
            Kdrkyt.success = function (nopkjnew) {
                $("#fld_Nopkj").empty();
                $("#fld_Nopkj").val(nopkjnew);
            };
            Kdrkyt.error = function () { $.simplyToast('@GlobalResEstate.msgError', 'danger'); };
            $.ajax(Kdrkyt);
         }

        if ($("#fld_Kdrkyt").val() == "MA") {
            document.getElementById('fld_Prmtno').disabled = true;
            document.getElementById('fld_T2prmt').disabled = true;
            document.getElementById('fld_T2pspt').disabled = true;
            document.getElementById('fld_Kodbkl').disabled = true;
        }

        $("#fld_Kdrkyt").change(function () {
            var Stspkt = {};
            var disableoption = "";
            Kdrkyt.url = "@Url.Action("GetNopkj", "BasicInfo")";
            Kdrkyt.type = "POST";
            Kdrkyt.data = JSON.stringify({ krkytn: $("#fld_Kdrkyt").val() });
            Kdrkyt.datatype = "json";
            Kdrkyt.contentType = "application/json";
            Kdrkyt.success = function (nopkjnew) {
                $("#fld_Nopkj").empty();
                $("#fld_Nopkj").val(nopkjnew);
            };
            Kdrkyt.error = function () { $.simplyToast('@GlobalResEstate.msgError', 'danger'); };
            $.ajax(Kdrkyt);
        });

        if ($("#fld_Poskod").val() == 0 && $("#fld_Neg").val() == 0 && $("#fld_Negra").val() == 0) {
            var Poskod = {};
            var disableoption = "";
            Poskod.url = "@Url.Action("GetDaerah", "BasicInfo")";
            Poskod.type = "POST";
            Poskod.data = JSON.stringify({ poskod: $("#fld_Poskod").val(), negeri: $("#fld_Neg").val(), negara: $("#fld_Negra").val() });
            Poskod.datatype = "json";
            Poskod.contentType = "application/json";
            Poskod.success = function (daerah) {
                $("#fld_Daerah").empty();
                $("#fld_Daerah").val(daerah);
            };
            Poskod.error = function () { $.simplyToast('@GlobalResEstate.msgError', 'danger'); };
            $.ajax(Poskod);
        }

        function getdaerah() {
            var Poskod = {};
            var disableoption = "";
            Poskod.url = "@Url.Action("GetDaerah", "BasicInfo")";
            Poskod.type = "POST";
            Poskod.data = JSON.stringify({ poskod: $("#fld_Poskod").val(), negeri: $("#fld_Neg").val(), negara: $("#fld_Negara").val() });
            Poskod.datatype = "json";
            Poskod.contentType = "application/json";
            Poskod.success = function (daerah) {
                $("#fld_Daerah").empty();
                $("#fld_Daerah").val(daerah);
            };
            Poskod.error = function () { $.simplyToast('@GlobalResEstate.msgError', 'danger'); };
            $.ajax(Poskod);
        }

        $("#fld_Poskod").change(function () {
            getdaerah();
        });

        $("#fld_Neg").change(function () {
            getdaerah();
        });

        $("#fld_Negara").change(function () {
            getdaerah();
        });

        $("#btnBatch").click(function (e) {
            e.preventDefault();
            var Batch = {};
            var disableoption = "";
            Batch.url = "@Url.Action("GetBatch", "BasicInfo")";
            Batch.type = "POST";
            Batch.data = JSON.stringify(/*{ krkytn: $("#fld_Kdrkyt").val() }*/);
            Batch.datatype = "json";
            Batch.contentType = "application/json";
            Batch.success = function (newbatch) {
                $("#fld_Batch").empty();
                $("#fld_Batch").val(newbatch);
            };
            Batch.error = function () { $.simplyToast('@GlobalResEstate.msgError', 'danger'); };
            $.ajax(Batch);
        });

        $("#fld_T1prmt").change(function () {
            var TmtPermit = {};
            var disableoption = "";
            TmtPermit.url = "@Url.Action("GetPermitExpired", "BasicInfo")";
            TmtPermit.type = "POST";
            TmtPermit.data = JSON.stringify({ permitDate: $("#fld_T1prmt").val() });
            TmtPermit.datatype = "json";
            TmtPermit.contentType = "application/json";
            TmtPermit.success = function (exprdDate) {
                var tarikhTamat = new Date(parseInt(exprdDate.substr(6)));
                var month = tarikhTamat.getMonth() + 1;
                var day = tarikhTamat.getDate();
                var year = tarikhTamat.getFullYear();
                var result = ("0" + tarikhTamat.getDate()).slice(-2) + '/' + ("0" + (tarikhTamat.getMonth()+1)).slice(-2) + '/' + year;
                $("#fld_T2prmt").empty();
                $("#fld_T2prmt").val(result.toString());
                //console.log(result);
                //console.log(tarikhTamat);
                //console.log(month);
                //console.log(year);
                //console.log(day);
                //console.log(exprdDate);
            };
            TmtPermit.error = function () { $.simplyToast('@GlobalResEstate.msgError', 'danger'); };
            $.ajax(TmtPermit);
        });

        @*$("#btnRequest").click(function (e) {
            //e.preventDefault();
            var request = {};
            var disableoption = "";
            request.url = "@Url.Action("Reapply", "BasicInfo")";
            request.type = "POST";
            request.data = JSON.stringify(/*{ krkytn: $("#fld_Kdrkyt").val() }*/);
            request.datatype = "json";
            request.contentType = "application/json";
            request.success = function (newbatch) {
                $("#fld_Batch").empty();
                $("#fld_Batch").val(newbatch);
            };
            Batch.error = function () { $.simplyToast('Sistem masalah', 'danger'); };
            $.ajax(Batch);
        });*@

        $("#image").click(function () {
            document.getElementById('file').click();
        });

        $("#btnUpload").click(function () {
            uploadImage();
            $("#UpdateProgress1").hide();
            document.getElementById('btnSubmit').click();
        });

         $("#btnUploadFile").click(function () {
            document.getElementById('file1').click();
            uploadSupportedFile();
            viewDoc();

        });

        function viewDoc() {
            console.log($("#fld_Nopkj").val());
             var reloadPage2 = {};
                            //console.log(tbl_Pkjmast);
                            reloadPage2.url = "@Url.Action("WorkerDoc", "BasicInfo")";
                            reloadPage2.type = "POST";
                            reloadPage2.data = { nopkj: $("#fld_Nopkj").val() };
                            reloadPage2.datatype = "json";
                            reloadPage2.success = function (result) {
                                $("#pdfdoc").html(result);
                                $("#UpdateProgress1").css("display", "none");
                            };
                            reloadPage2.error = function () {
                                $("#UpdateProgress1").css("display", "none");
                                $.simplyToast('@GlobalResEstate.msgError', 'danger');
                            };
                            $.ajax(reloadPage2);
         }

        if ($("#fld_Nopkj").val() != "") {
           var reloadPage2 = {};
                            //console.log(tbl_Pkjmast);
                            reloadPage2.url = "@Url.Action("WorkerDoc", "BasicInfo")";
                            reloadPage2.type = "POST";
                            reloadPage2.data = { nopkj: $("#fld_Nopkj").val() };
                            reloadPage2.datatype = "json";
                            reloadPage2.success = function (result) {
                                $("#pdfdoc").html(result);
                                $("#UpdateProgress1").css("display", "none");
                            };
                            reloadPage2.error = function () {
                                $("#UpdateProgress1").css("display", "none");
                                $.simplyToast('@GlobalResEstate.msgError', 'danger');
                            };
                            $.ajax(reloadPage2);
        }
    });

    //sepul tambah 21/09/2021
        function InputToUpper(obj)
        {
            if (obj.value!="")
            {
            obj.value = obj.value.toUpperCase();
            }
    }

    //sepul tambah filter utk no permit 08/10/2021
    $("#fld_Prmtno").keyup(function (e) {
        var nopermit = $("#fld_Prmtno").val();
        nopermit = nopermit.replace(/\s/g, '');
        $("#fld_Prmtno").val(nopermit.toUpperCase());
    });

    //kamy tambah 30/09/2021
    $("#btnBack").click(function (e) {
            e.preventDefault();
            var Batch = {};
        var disableoption = "";
        //sepul tambah 08/10/2021
        var personalInfo = $("#mklmtPeribadi").find(":input");
        var workerlInfo = $("#mklmtPkj").find(":input");
        var acclInfo = $("#mklmtAkaun").find(":input");
        var heirslInfo = $("#mklmtWaris").find(":input");
        //sampai sini
            Batch.url = "@Url.Action("GetBatchNoCancel", "BasicInfo")";
            Batch.type = "POST";
            Batch.data = JSON.stringify({ pkjmstbatchno: 'pkjmstbatchno' });
            Batch.datatype = "json";
            Batch.contentType = "application/json";
            Batch.success = function (newbatch) {
                personalInfo.prop("disabled", false);
                workerlInfo.prop("disabled", false);
                acclInfo.prop("disabled", false);
                heirslInfo.prop("disabled", false);
                $("#fld_Batch").empty();
                $("#fld_Batch").val(newbatch);
                //$("#fld_Batch").prop("disabled", true);

                //for (var i = 0; i < newbatch.length){
                //    if ($("#CreateBatch").val == 0) {
                //        disableoption = "disabled";
                //    }
                //}
            };
            Batch.error = function () { $.simplyToast('@GlobalResEstate.msgError', 'danger'); };
            $.ajax(Batch);
    });

    //added by faeza 08.11.2021
    $('#btnSubmit').click(function () {
        //debugger
        var flag = 0;
        var fld_Nopkj = $("#fld_Nopkj").val();
        var fld_Nama = $("#fld_Nama").val();
        var fld_Nokp = $("#fld_Nokp").val();
        var fld_Trlhr = $("#fld_Trlhr").val();
        var fld_Kdjnt = $("#fld_Kdjnt").val();
        var fld_Kdkwn = $("#fld_Kdkwn").val();
        var fld_Kpenrka = $("#fld_Kpenrka").val();
        var fld_Kdbgsa = $("#fld_Kdbgsa").val();
        var fld_Kdagma = $("#fld_Kdagma").val();
        var fld_Kdrkyt = $("#fld_Kdrkyt").val(); //tidak dibenarkan edit kerakyatan
        var fld_Almt1 = $("#fld_Almt1").val();
        var fld_Poskod = $("#fld_Poskod").val();
        var fld_Daerah = $("#fld_Daerah").val();
        var fld_Neg = $("#fld_Neg").val();
        var fld_Negara = $("#fld_Negara").val();
        var fld_Jenispekerja = $("#fld_Jenispekerja").val();
        var fld_Ktgpkj = $("#fld_Ktgpkj").val();
        var fld_Trshjw = $("#fld_Trshjw").val();
        var fld_Trmlkj = $("#fld_Trmlkj").val();
        var fld_T2pspt = $("#fld_T2pspt").val();
        var fld_Kodbkl = $("#fld_Kodbkl").val();
        var fld_Notel = $("#fld_Notel").val();
        var fld_PaymentMode = $("#fld_PaymentMode").val();
        var fld_Last4Pan = $("#fld_Last4Pan").val();

        /*Added by Shazana 18/6/2023*/
        var fld_T2prmt1 = $("#fld_T2prmt").val();
        var newData = fld_T2prmt1.replace(/(\d+[/])(\d+[/])/, '$2$1');
        var data = new Date(newData);
        let date_2 = new Date();
        let difference = data.getTime() - date_2.getTime();
        console.log(difference);
        let TotalDays = Math.ceil(difference / (1000 * 3600 * 24));

        if (fld_Nopkj === "") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('No. Pekerja adalah wajib', "danger");
        }
        else if (fld_Nama === "") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila masukkan nama pekerja', "danger");
        }
        else if (fld_Nokp === "") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila masukkan No. IC/Passport', "danger");
        }
        else if (fld_Trlhr === "") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila masukkan tarikh lahir', "danger");
        }
        else if (fld_Kdjnt === "0") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila pilih jantina', "danger");
        }
        else if (fld_Kdkwn === "0") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila pilih status perkahwinan', "danger");
        }
        else if (fld_Kpenrka === "0") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila pilih keluarga peneroka', "danger");
        }
        else if (fld_Kdbgsa === "0") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila pilih bangsa', "danger");
        }
        else if (fld_Kdagma === "0") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila pilih agama', "danger");
        }
        else if (fld_Kdrkyt === "0") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila pilih kerakyatan', "danger");
        }
        else if (fld_Almt1 === "") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila masukkan alamat', "danger");
        }
        else if (fld_Poskod === "") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila masukkan poskod', "danger");
        }
        else if (fld_Daerah === "") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila masukkan daerah', "danger");
        }
        else if (fld_Neg === "0") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila pilih negeri', "danger");
        }
        else if (fld_Negara === "0") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila pilih negera', "danger");
        }
        else if (fld_Notel === "") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila masukkan no. telefon', "danger");
        }
        else if (fld_PaymentMode === "0") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila pilih mod bayaran', "danger");
        }
        else if (fld_Jenispekerja === "0" ) {
                $("#UpdateProgress1").css("display", "none");
                $.simplyToast('Sila pilih jenis pekerja', "danger");
        }
        else if (fld_Ktgpkj === "0") {
                $("#UpdateProgress1").css("display", "none");
                $.simplyToast('Sila pilih kategori pekerja', "danger");
        }
        else if (fld_Trmlkj === "") {
                $("#UpdateProgress1").css("display", "none");
                $.simplyToast('Sila masukkan tarikh cop imigresen/lantikan', "danger");
        }
        else if (fld_Trshjw === "") {
                $("#UpdateProgress1").css("display", "none");
                $.simplyToast('Sila masukkan tarikh mula khidmat', "danger");
        }
        else if (fld_Kdrkyt != "MA" && fld_T2pspt === "") {
                $("#UpdateProgress1").css("display", "none");
                $.simplyToast('Sila masukkan tarikh tamat passport', "danger");
        }
        else if (fld_Kdrkyt != "MA" && (fld_Kodbkl === "0" || fld_Kodbkl === "")) {
                $("#UpdateProgress1").css("display", "none");
                $.simplyToast('Sila pilih pembekal', "danger");
        }
        else if (fld_PaymentMode === "3" && fld_Last4Pan === "") {
                $("#UpdateProgress1").css("display", "none");
                $.simplyToast('Sila masukkan no. 4 PAN terakhir', "danger");
        }
        else if (fld_PaymentMode === "3" && fld_Last4Pan.length < 4) {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Sila masukkan 4 digit', "danger");
        }
        /*Added by Shazana 18/6/2023*/
        else if (TotalDays > 366 && fld_Kdrkyt != "MA") {
            $("#UpdateProgress1").css("display", "none");
            $.simplyToast('Tarikh tamat permit tidak boleh melebihi 12 bulan dari tarikh hari ini', "danger");
        }
        else {
            if (flag === 0) {
                var tbl_Pkjmast = {
                    fld_Batch: $("#fld_Batch").val(),
                    fld_Nopkj: $("#fld_Nopkj").val(),
                    fld_NoPkjLama: $("#fld_NoPkjLama").val(),
                    fld_Nama: $("#fld_Nama").val(),
                    fld_Nokp: $("#fld_Nokp").val(),
                    //fld_Nokp: $("#fld_Nokp").val(),
                    fld_Trlhr: $("#fld_Trlhr").val(),
                    fld_Kdjnt: $("#fld_Kdjnt").val(),
                    fld_Kdkwn: $("#fld_Kdkwn").val(),
                    fld_Kpenrka: $("#fld_Kpenrka").val(),
                    fld_Kdbgsa: $("#fld_Kdbgsa").val(),
                    fld_Kdagma: $("#fld_Kdagma").val(),
                    fld_Kdrkyt: $("#fld_Kdrkyt").val(),
                    fld_Almt1: $("#fld_Almt1").val(),
                    fld_Poskod: $("#fld_Poskod").val(),
                    fld_Daerah: $("#fld_Daerah").val(),
                    fld_Neg: $("#fld_Neg").val(),
                    fld_Negara: $("#fld_Negara").val(),
                    fld_Jenispekerja: $("#fld_Jenispekerja").val(),
                    fld_Ktgpkj: $("#fld_Ktgpkj").val(),
                    fld_Prmtno: $("#fld_Prmtno").val(),
                    fld_T2prmt: $("#fld_T2prmt").val(),
                    fld_T2pspt: $("#fld_T2pspt").val(),
                    fld_Trmlkj: $("#fld_Trmlkj").val(),
                    fld_Trshjw: $("#fld_Trshjw").val(),
                    fld_Kodbkl: $("#fld_Kodbkl").val(),
                    fld_Notel: $("#fld_Notel").val(),
                    fld_PaymentMode: $("#fld_PaymentMode").val(),
                    fld_Last4Pan: $("#fld_Last4Pan").val()
                };

                var reloadPage = {};
                console.log(tbl_Pkjmast);
                reloadPage.url = "@Url.Action("WorkerUpdate", "BasicInfo")";
                reloadPage.type = "POST";
                reloadPage.data = { Pkjmast: tbl_Pkjmast, id: $("#fld_Nopkj").val() };
                reloadPage.datatype = "json";
                reloadPage.success = function (result) {
                    $("#content").html(result.bodyview);
                    //$("#fld_Batch").val();
                /*  $("#fld_Nopkj").val("");*/
                    $("#fld_NoPkjLama").val("");
                    $("#fld_Nama").val("");
                    $("#fld_Nokp").val("");
                    $("#fld_Trlhr").val("");
                    $("#fld_Kdjnt").val(0);
                    $("#fld_Kdkwn").val(0);
                    $("#fld_Kpenrka").val(0);
                    $("#fld_Kdbgsa").val(0);
                    $("#fld_Kdagma").val(0);
                    $("#fld_Kdrkyt").val(0);
                    $("#fld_Almt1").val("");
                    $("#fld_Poskod").val("");
                    $("#fld_Daerah").val("");
                    $("#fld_Neg").val(0);
                    $("#fld_Negara").val(0);
                    $("#fld_Jenispekerja").val(0);
                    $("#fld_Ktgpkj").val(0);
                    $("#fld_Prmtno").val("");
                    //$("#fld_T1prmt").val("");
                    $("#fld_T2prmt").val("");
                    //$("#fld_T1pspt").val("");
                    $("#fld_T2pspt").val("");
                    $("#fld_Trmlkj").val("");
                    $("#fld_Trshjw").val("");
                    $("#fld_Kodbkl").val(0);
                    $("#fld_Notel").val("");
                    $("#fld_PaymentMode").val(0);
                    $("#fld_Last4Pan").val("");

                    $.simplyToast(result.msg, result.statusmsg);
                };
                reloadPage.error = function () { $.simplyToast('@GlobalResEstate.msgError', 'danger'); };
                $.ajax(reloadPage);
            }
        }
    });

    $(".digit").keypress(function (e) {
        if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
            $("#errormsg").html("Digits Only").show().fadeOut("slow");
            return false;
        }
    });

    $(".numeric").keypress(function (e) {
        if (e.which == 8 || e.which == 0 || (!(e.which >= 48 && e.which <= 57) && !(e.which > 96 && e.which < 123) && !(e.which > 64 && e.which < 91) && e.which != 32)) {
            $("#errormsg").html("Special character not allowed").show().fadeOut("slow");
            return false;
        }
    });
    //end added by faeza 

</script>


